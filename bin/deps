#!/usr/bin/python3

#
# (C) BLACKTRIANGLES 2019
# http://www.blacktriangles.com/
#

import deps.file
import deps.patch
import deps.project
import click
import os

#
# main cli entrypoint #########################################################
#

@click.group()
def cli():
    pass

#
# bootstrap ###################################################################
#

@cli.command()
def setup():
    cwd = os.getcwd()
    deps.project.Project(cwd).install()

#
# dep management ##############################################################
#

@cli.command()
@click.argument('name')
@click.argument('repo')
@click.option('--sha', default=None, help="An optional commit sha to check out to.")
@click.option('--tag', default=None, help="An optional tag to check out to.")
def add(name, repo, sha, tag):
    cwd = os.getcwd()
    deps.file.add_dependency_to_file(cwd, name, repo, sha, tag)
    deps.project.Project(cwd).install()

#
# -----------------------------------------------------------------------------
#

@cli.command()
@click.argument('name')
def remove(name):
    cwd = os.getcwd()
    deps.file.remove_dependency_from_file(cwd, name)
    deps.project.Project(cwd).install()

#
# patches #####################################################################
#

@cli.group()
def patch():
    pass

@patch.command('create')
@click.argument('name')
def createPatch(name):
    cwd = os.getcwd()
    deps.patch.create_patch(cwd, name)


#
# entry point #################################################################
#

if (__name__ == '__main__'):
    cli()

